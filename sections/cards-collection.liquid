<div class="collection-template">
  <div class="sidebar">
    <!-- Collections Dropdown -->
    <form id="CollectionForm" method="get">
      <label for="CollectionSelect">Select Collection: </label>
      <select name="collection" id="CollectionSelect" onchange="this.form.submit()">
        {% for collection in collections %}
          <option value="{{ collection.handle }}" {% if collection.handle == request.query.collection %}selected{% endif %}>
            {{ collection.title }}
          </option>
        {% endfor %}
      </select>
    </form>
    
    <!-- Sorting Dropdown -->
    <form id="SortByForm" method="get">
      <label for="SortBy">Sort By: </label>
      <select name="sort_by" id="SortBy" onchange="this.form.submit()">
        <option value="manual" {% if request.query.sort_by == 'manual' %}selected{% endif %}>{{ 'Default' }}</option>
        <option value="best-selling" {% if request.query.sort_by == 'best-selling' %}selected{% endif %}>{{ 'Best selling' }}</option>
        <option value="title-ascending" {% if request.query.sort_by == 'title-ascending' %}selected{% endif %}>{{ 'Alphabetically, A-Z' }}</option>
        <option value="title-descending" {% if request.query.sort_by == 'title-descending' %}selected{% endif %}>{{ 'Alphabetically, Z-A' }}</option>
        <option value="price-ascending" {% if request.query.sort_by == 'price-ascending' %}selected{% endif %}>{{ 'Price, low to high' }}</option>
        <option value="price-descending" {% if request.query.sort_by == 'price-descending' %}selected{% endif %}>{{ 'Price, high to low' }}</option>
        <option value="created-descending" {% if request.query.sort_by == 'created-descending' %}selected{% endif %}>{{ 'Date, new to old' }}</option>
        <option value="created-ascending" {% if request.query.sort_by == 'created-ascending' %}selected{% endif %}>{{ 'Date, old to new' }}</option>
      </select>
    </form>
  </div>

  <div class="main-content">
    {% assign selected_collection_handle = request.query.collection %}
    {% assign selected_collection = collections[selected_collection_handle] %}
    
    {% if selected_collection %}
      {% paginate selected_collection.products by products_per_page %}
        <div class="product-grid" style="grid-template-columns: repeat({{ columns_desktop }}, 1fr);">
          {% for product in selected_collection.products %}
            <div class="product-grid__item">
              {% render 'product-card', product: product %}
            </div>
          {% endfor %}
        </div>
        {% render 'pagination' %}
      {% endpaginate %}
    {% else %}
      <p>No collection selected or collection not found.</p>
    {% endif %}
  </div>
</div>

<style>
  .collection-template {
    display: flex;
    flex-direction: row;
    gap: 20px;
  }

  .sidebar {
    flex: 1;
    max-width: 250px; /* Optional: limit width */
  }

  .main-content {
    flex: 3;
  }

  .product-grid {
    display: grid;
    gap: 20px;
  }

  @media (max-width: 749px) {
    .product-grid {
      grid-template-columns: repeat({{ columns_mobile }}, 1fr);
    }
  }

  @media (min-width: 750px) {
    .product-grid {
      grid-template-columns: repeat({{ columns_desktop }}, 1fr);
    }
  }

  form {
    margin-bottom: 20px;
  }
</style>
