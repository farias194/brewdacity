<div class="collection-template">
  <div class="sidebar">
    <!-- Collections Dropdown -->
    <form id="CollectionForm" method="get">
      <label for="CollectionSelect">Select Collection: </label>
      <select name="collection" id="CollectionSelect" onchange="this.form.submit()">
        {% if section.settings.collection_1 %}
          <option value="{{ section.settings.collection_1.handle }}" {% if request.query.collection == section.settings.collection_1.handle %}selected{% endif %}>
            {{ section.settings.collection_1.title }}
          </option>
        {% endif %}
        {% if section.settings.collection_2 %}
          <option value="{{ section.settings.collection_2.handle }}" {% if request.query.collection == section.settings.collection_2.handle %}selected{% endif %}>
            {{ section.settings.collection_2.title }}
          </option>
        {% endif %}
      </select>
    </form>
    
    <!-- Sorting Dropdown -->
    <form id="SortByForm" method="get">
      <label for="SortBy">Sort By: </label>
      <select name="sort_by" id="SortBy" onchange="this.form.submit()">
        <option value="manual" {% if request.query.sort_by == 'manual' %}selected{% endif %}>{{ 'Default' }}</option>
        <option value="best-selling" {% if request.query.sort_by == 'best-selling' %}selected{% endif %}>{{ 'Best selling' }}</option>
        <option value="title-ascending" {% if request.query.sort_by == 'title-ascending' %}selected{% endif %}>{{ 'Alphabetically, A-Z' }}</option>
        <option value="title-descending" {% if request.query.sort_by == 'title-descending' %}selected{% endif %}>{{ 'Alphabetically, Z-A' }}</option>
        <option value="price-ascending" {% if request.query.sort_by == 'price-ascending' %}selected{% endif %}>{{ 'Price, low to high' }}</option>
        <option value="price-descending" {% if request.query.sort_by == 'price-descending' %}selected{% endif %}>{{ 'Price, high to low' }}</option>
        <option value="created-descending" {% if request.query.sort_by == 'created-descending' %}selected{% endif %}>{{ 'Date, new to old' }}</option>
        <option value="created-ascending" {% if request.query.sort_by == 'created-ascending' %}selected{% endif %}>{{ 'Date, old to new' }}</option>
      </select>
    </form>
  </div>

  <div class="main-content">
    {% assign selected_collection_handle = request.query.collection %}
    {% assign selected_collection = collections[selected_collection_handle] %}
    
    {% if selected_collection %}
      {% paginate selected_collection.products by products_per_page %}
        <div class="product-grid" style="grid-template-columns: repeat({{ columns_desktop }}, 1fr);">
          {% for product in selected_collection.products %}
            <div class="product-grid__item">
              {% render 'product-card', product: product %}
            </div>
          {% endfor %}
        </div>
        {% render 'pagination' %}
      {% endpaginate %}
    {% else %}
      <p>No collection selected or collection not found.</p>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Cards Collection",
  "settings": [
    {
      "type": "range",
      "id": "products_per_page",
      "label": "Products Per Page",
      "min": 4,
      "max": 20,
      "step": 4,
      "default": 16
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "label": "Columns (Mobile)",
      "min": 1,
      "max": 4,
      "step": 1,
      "default": 2
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "label": "Columns (Desktop)",
      "min": 2,
      "max": 6,
      "step": 1,
      "default": 4
    },
    {
      "type": "collection",
      "id": "collection_1",
      "label": "Collection 1",
      "default": ""
    },
    {
      "type": "collection",
      "id": "collection_2",
      "label": "Collection 2",
      "default": ""
    }
  ],
  "presets": [
    {
      "name": "Default",
      "category": "Custom"
    }
  ]
}
{% endschema %}

<style>
  .collection-template {
    display: flex;
    flex-direction: row;
    gap: 20px;
  }

  .sidebar {
    flex: 1;
    max-width: 250px; /* Optional: limit width */
  }

  .main-content {
    flex: 3;
  }

  .product-grid {
    display: grid;
    gap: 20px;
  }

  @media (max-width: 749px) {
    .product-grid {
      grid-template-columns: repeat({{ columns_mobile }}, 1fr);
    }
  }

  @media (min-width: 750px) {
    .product-grid {
      grid-template-columns: repeat({{ columns_desktop }}, 1fr);
    }
  }

  form {
    margin-bottom: 20px;
  }
</style>
